<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Partido</title>
  <style>
    @font-face {
      font-family: 'Qatar2022';
      src: url('qatar2022.ttf') format('truetype');
    }

    * {
      font-family: 'Qatar2022', sans-serif;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at center, #8A1538, #5a0f26);
      color: white;
      text-align: center;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 10px 0;
      z-index: 10;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin: 0 20px;
      font-size: 18px;
    }

    h1 {
      font-size: 42px;
      margin-top: 70px;
    }

    .match-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 40px;
      gap: 100px;
    }

    .shield {
      background: white;
      padding: 30px;
      clip-path: polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%);
    }

    .shield img {
      width: 150px;
    }

    .marcador {
      background-color: #E91E63;
      padding: 30px 60px;
      font-size: 60px;
      border-radius: 20px;
      font-weight: bold;
      color: white;
    }

    .cronometro {
      font-size: 32px;
      margin: 20px 0;
    }

    .botones {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }

    .botones-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-control {
      background: white;
      color: #8A1538;
    }

    .btn-gol {
      background: #FFD700;
      color: #5a0f26;
    }

    .btn-finalizar {
      background: #ffffff;
      color: #8A1538;
      margin-top: 10px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      color: #8A1538;
      width: 300px;
    }

    .modal-content input {
      font-size: 16px;
      padding: 10px;
      margin-top: 10px;
      width: 100%;
    }

    .confetti {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      top: 0;
      left: 0;
      z-index: 50;
    }
  </style>
</head>
<body>

<nav>
  <a href="match.html">üéÆ Nuevo Partido</a>
  <a href="index.html">üìä Tabla</a>
  <a href="goleadores.html">ü•á M√°ximo Goleador</a>
  <a href="historial.html">üìã Historial de Partidos</a>
</nav>

<h1>PARTIDO EN JUEGO</h1>

<div class="match-container">
  <div class="shield"><img id="logo1" src=""></div>
  <div class="marcador" id="marcador">0 : 0</div>
  <div class="shield"><img id="logo2" src=""></div>
</div>

<div class="cronometro" id="cronometro">00:00</div>

<div class="botones">
  <div class="botones-row">
    <button class="btn-control" onclick="iniciar()">‚ñ∂ Iniciar</button>
    <button class="btn-control" onclick="pausar()">‚è∏ Pausar</button>
    <button class="btn-control" onclick="reiniciar()">üîÅ Reiniciar</button>
  </div>

  <div class="botones-row">
    <button id="btnGol1" class="btn-gol" onclick="gol(1)">‚öΩ Gol</button>
    <button id="btnGol2" class="btn-gol" onclick="gol(2)">‚öΩ Gol</button>
  </div>

  <button class="btn-finalizar" onclick="finalizarPartido()">üõë Finalizar Partido</button>
</div>

<div class="modal" id="modalGoleador">
  <div class="modal-content">
    <h3>¬øQui√©n anot√≥ el gol?</h3>
    <input type="text" id="goleador" placeholder="Nombre del jugador">
    <button onclick="guardarGol()">Registrar</button>
  </div>
</div>

<canvas id="confetti" class="confetti"></canvas>

<script>
  const equipo1 = JSON.parse(localStorage.getItem("equipo1"));
  const equipo2 = JSON.parse(localStorage.getItem("equipo2"));
  const genero = localStorage.getItem("genero") || "masculino";

  document.getElementById("logo1").src = equipo1.logo;
  document.getElementById("logo2").src = equipo2.logo;
  document.getElementById("btnGol1").innerText = `‚öΩ Gol ${equipo1.name}`;
  document.getElementById("btnGol2").innerText = `‚öΩ Gol ${equipo2.name}`;

  let goles1 = 0, goles2 = 0;
  let tiempo = 0;
  let intervalo = null;
  let enJuego = false;
  let estabaJugando = false;
  let equipoActual = 0;
  let partidoFinalizado = false;
  const goleadores = [];

  function actualizarCrono() {
    const min = String(Math.floor(tiempo / 60)).padStart(2, '0');
    const seg = String(tiempo % 60).padStart(2, '0');
    document.getElementById("cronometro").textContent = `${min}:${seg}`;
  }

  function actualizarMarcador() {
    document.getElementById("marcador").textContent = `${goles1} : ${goles2}`;
  }

  function iniciar() {
    if (intervalo || partidoFinalizado) return;
    intervalo = setInterval(() => {
      tiempo++;
      actualizarCrono();
    }, 1000);
    enJuego = true;
  }

  function pausar() {
    if (partidoFinalizado) return;
    clearInterval(intervalo);
    intervalo = null;
    enJuego = false;
  }

  function reiniciar() {
    if (partidoFinalizado) return;
    pausar();
    tiempo = 0;
    actualizarCrono();
  }

  function gol(equipo) {
    if (!enJuego || partidoFinalizado) {
      alert("‚õî El cron√≥metro est√° pausado o el partido ha finalizado");
      return;
    }
    equipoActual = equipo;
    estabaJugando = enJuego;
    pausar();
    document.getElementById("modalGoleador").style.display = "flex";
  }
function guardarGol() {
  const nombre = document.getElementById("goleador").value.trim();
  if (!nombre) return alert("‚ö†Ô∏è Escrib√≠ el nombre del goleador");

  if (equipoActual === 1) goles1++;
  else goles2++;

  goleadores.push({ equipo: equipoActual, nombre });

  actualizarMarcador();
  document.getElementById("modalGoleador").style.display = "none";
  document.getElementById("goleador").value = "";
  lanzarConfeti();
  document.getElementById("golSound").play();
  if (estabaJugando) iniciar();

  // üî• NUEVO: Guardar detalle con g√©nero
  const detalles = JSON.parse(localStorage.getItem("goleadoresDetalles")) || {};
  if (!detalles[nombre]) detalles[nombre] = [];
  detalles[nombre].push({
    fecha: new Date().toLocaleString(),
    equipo1: equipo1.name,
    equipo2: equipo2.name,
    minuto: `${String(Math.floor(tiempo / 60)).padStart(2, '0')}:${String(tiempo % 60).padStart(2, '0')}`,
    genero: genero
  });
  localStorage.setItem("goleadoresDetalles", JSON.stringify(detalles));
}


  function finalizarPartido() {
    if (!enJuego || partidoFinalizado) {
      alert("‚õî El partido no est√° en juego.");
      return;
    }
    pausar();
    partidoFinalizado = true;

    // Registrar en posiciones
    const key = genero === "femenino" ? "posicionesFemenino" : "posicionesMasculino";
    const posiciones = JSON.parse(localStorage.getItem(key)) || {};

    [equipo1.name, equipo2.name].forEach(name => {
      if (!posiciones[name]) {
        posiciones[name] = { PJ:0, G:0, E:0, P:0, GF:0, GC:0, Pts:0 };
      }
    });

    posiciones[equipo1.name].PJ++;
    posiciones[equipo2.name].PJ++;
    posiciones[equipo1.name].GF += goles1;
    posiciones[equipo1.name].GC += goles2;
    posiciones[equipo2.name].GF += goles2;
    posiciones[equipo2.name].GC += goles1;

    if (goles1 > goles2) {
      posiciones[equipo1.name].G++;
      posiciones[equipo1.name].Pts += 3;
      posiciones[equipo2.name].P++;
    } else if (goles2 > goles1) {
      posiciones[equipo2.name].G++;
      posiciones[equipo2.name].Pts += 3;
      posiciones[equipo1.name].P++;
    } else {
      posiciones[equipo1.name].E++;
      posiciones[equipo2.name].E++;
      posiciones[equipo1.name].Pts += 1;
      posiciones[equipo2.name].Pts += 1;
    }

    localStorage.setItem(key, JSON.stringify(posiciones));

    // Historial
    const historial = JSON.parse(localStorage.getItem("historialPartidos")) || [];
    historial.unshift({
      fecha: new Date().toLocaleString(),
      genero,
      equipo1: equipo1.name,
      equipo2: equipo2.name,
      marcador: `${goles1} - ${goles2}`,
      tiempo
    });
    localStorage.setItem("historialPartidos", JSON.stringify(historial));

    // Goleadores
    const tablaG = JSON.parse(localStorage.getItem("goleadores")) || {};
    goleadores.forEach(({ nombre }) => {
      if (!tablaG[nombre]) tablaG[nombre] = 0;
      tablaG[nombre]++;
    });
    localStorage.setItem("goleadores", JSON.stringify(tablaG));

    alert("‚úÖ Partido finalizado y registrado correctamente.");
    window.location.href = "index.html";
  }

  function lanzarConfeti() {
    const duration = 2 * 1000;
    const end = Date.now() + duration;
    const colors = ['#FFD700', '#FFFFFF', '#FF69B4'];
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const confettis = [];
    document.getElementById("golSound").play();


    for (let i = 0; i < 150; i++) {
      confettis.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 2,
        d: Math.random() * 10 + 2,
        color: colors[Math.floor(Math.random() * colors.length)],
        tilt: Math.random() * 10 - 10
      });
    }

    const interval = setInterval(() => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      confettis.forEach(c => {
        c.y += c.d;
        c.tilt += Math.random() * 0.2 - 0.1;
        ctx.beginPath();
        ctx.arc(c.x + c.tilt, c.y, c.r, 0, Math.PI * 2);
        ctx.fillStyle = c.color;
        ctx.fill();
      });
      if (Date.now() > end) {
        clearInterval(interval);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }, 16);
  }

  // Prevenci√≥n de cierre o recarga
  window.addEventListener('beforeunload', function (e) {
    if (enJuego && !partidoFinalizado) {
      e.preventDefault();
      e.returnValue = '‚ö†Ô∏è Hay un partido en curso. ¬øEst√°s seguro?';
      return '‚ö†Ô∏è Hay un partido en curso. ¬øEst√°s seguro?';
    }
  });

  window.addEventListener('keydown', function(e) {
    if ((e.key === "F5" || e.key === "Backspace") && enJuego && !partidoFinalizado) {
      e.preventDefault();
    }
  });

  actualizarCrono();
  actualizarMarcador();
</script>
<audio id="golSound" src="GOL.mp3" preload="auto"></audio>

</body>
</html>

