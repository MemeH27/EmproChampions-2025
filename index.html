<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tabla de Posiciones - Empro Champions</title>
  <link rel="stylesheet" href="styles/index.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

<nav>
  <div class="menu-toggle" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div class="links" id="navLinks">
    <a href="index.html">🏆 Tabla</a>
    <a href="match.html">🎮 Nuevo Partido</a>
    <a href="goleadores.html">🥇 Goleadores</a>
    <a href="historial.html">📋 Historial</a>
  </div>
</nav>

<div style="margin-top: 100px;">
  <img src="logo2.png" alt="Logo Tabla" style="max-width: 90%; height: auto;" />
</div>

<div class="toggle-container">
  <button id="btnMasculino" onclick="mostrarTabla('masculino')" class="btn-activo">Masculino</button>
  <button id="btnFemenino" onclick="mostrarTabla('femenino')" class="btn-inactivo">Femenino</button>
</div>

<table>
  <thead>
    <tr>
      <th>Pos</th><th>Equipo</th><th>PJ</th><th>G</th><th>E</th><th>P</th>
      <th>GF</th><th>GC</th><th>DG</th><th>Pts</th>
    </tr>
  </thead>
  <tbody id="tablaCuerpo"></tbody>
</table>

<div style="margin-bottom: 60px;">
  <button onclick="reiniciarTorneo()" style="
    background: transparent;
    border: 2px solid white;
    color: white;
    padding: 10px 30px;
    border-radius: 10px;
    font-size: 16px;
    font-family: 'Qatar2022', sans-serif;
    cursor: pointer;
    margin-top: 40px;
  ">
    🗑️ Reiniciar Torneo
  </button>
</div>

<script>
  function toggleMenu() {
    document.getElementById('navLinks').classList.toggle('active');
  }
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";
  import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD9cpSfGG212h80iXofJetw-B-arEEcOvI",
    authDomain: "emprochampions2025.firebaseapp.com",
    projectId: "emprochampions2025",
    storageBucket: "emprochampions2025.appspot.com",
    messagingSenderId: "683206087538",
    appId: "1:683206087538:web:8a1473aec968bd6ab543eb",
    measurementId: "G-3TX5J3NDT5"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase();

  let generoActual = "masculino";

  function mostrarTabla(genero) {
    generoActual = genero;

    const btnM = document.getElementById("btnMasculino");
    const btnF = document.getElementById("btnFemenino");

    btnM.classList.toggle("btn-activo", genero === "masculino");
    btnM.classList.toggle("btn-inactivo", genero !== "masculino");
    btnF.classList.toggle("btn-activo", genero === "femenino");
    btnF.classList.toggle("btn-inactivo", genero !== "femenino");

    const ruta = genero === "femenino" ? "posicionesFemenino" : "posicionesMasculino";
    const tablaRef = ref(db, ruta);

    onValue(tablaRef, (snapshot) => {
      const data = snapshot.val() || {};
      const tabla = Object.entries(data).map(([equipo, s]) => ({
        equipo, ...s, DG: s.GF - s.GC
      })).sort((a, b) => b.Pts - a.Pts || b.DG - a.DG || b.GF - a.GF);

      const cuerpo = document.getElementById("tablaCuerpo");
      cuerpo.innerHTML = "";

      tabla.forEach((row, i) => {
        cuerpo.innerHTML += `
          <tr>
            <td>${i + 1}</td><td>${row.equipo}</td><td>${row.PJ}</td>
            <td>${row.G}</td><td>${row.E}</td><td>${row.P}</td>
            <td>${row.GF}</td><td>${row.GC}</td><td>${row.DG}</td><td>${row.Pts}</td>
          </tr>
        `;
      });
    });
  }

  mostrarTabla("masculino");

  window.reiniciarTorneo = function () {
    if (confirm("¿Estás seguro de que deseas reiniciar todo el torneo? Esto eliminará todas las tablas, historial y goleadores.")) {
      const refs = ["posicionesMasculino", "posicionesFemenino", "historialPartidos", "goleadores", "goleadoresDetalles"];
      refs.forEach((key) => remove(ref(db, key)));
      alert("Torneo reiniciado correctamente.");
      location.reload();
    }
  };
</script>

</body>
</html>
